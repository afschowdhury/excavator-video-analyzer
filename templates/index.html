<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excavator Video Analyzer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>ðŸšœ Excavator Video Analyzer</h1>
            <p>Analyze excavator performance using AI-powered insights</p>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Panel -->
            <div class="left-panel">
                <div class="card">
                    <h2>Analysis Configuration</h2>
                    
                    <!-- Analyzer Selection -->
                    <div class="form-group">
                        <label for="analyzer-select">AI Analyzer</label>
                        <select id="analyzer-select" class="form-control">
                            {% for analyzer in analyzer_types %}
                            <option value="{{ analyzer.id }}">{{ analyzer.name }}</option>
                            {% endfor %}
                        </select>
                        <p id="analyzer-description" class="description"></p>
                    </div>

                    <!-- GPT-5 Configuration (hidden by default) -->
                    <div id="gpt5-config" class="hidden">
                        <!-- Model Selection -->
                        <div class="form-group">
                            <label for="gpt5-model">GPT-5 Model</label>
                            <select id="gpt5-model" class="form-control">
                                {% for model in gpt5_config.models %}
                                <option value="{{ model.id }}" {% if model.id == gpt5_config.default_model %}selected{% endif %}>
                                    {{ model.name }} - {{ model.description }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- FPS Selection -->
                        <div class="form-group">
                            <label for="fps-select">Frame Rate (FPS)</label>
                            <select id="fps-select" class="form-control">
                                {% for fps in gpt5_config.fps_options %}
                                <option value="{{ fps }}" {% if fps == gpt5_config.default_fps %}selected{% endif %}>
                                    {{ fps }} FPS {% if fps == 1 %}(Fastest, cheapest){% elif fps == 3 %}(Balanced){% elif fps >= 5 %}(More detailed){% endif %}
                                </option>
                                {% endfor %}
                            </select>
                            <p class="description">Higher FPS = More frames analyzed = Better accuracy but slower & more expensive</p>
                        </div>

                        <!-- Max Frames Selection -->
                        <div class="form-group">
                            <label for="max-frames-select">Maximum Frames to Analyze</label>
                            <select id="max-frames-select" class="form-control">
                                {% for option in gpt5_config.max_frames_options %}
                                <option value="{{ option.value if option.value else '' }}">
                                    {{ option.label }}
                                </option>
                                {% endfor %}
                            </select>
                            <p class="description">Limit total frames for testing or cost control. Leave at "All frames" for complete analysis.</p>
                        </div>
                    </div>

                    <!-- Prompt Selection (for Gemini) -->
                    <div class="form-group" id="prompt-group">
                        <label for="prompt-select">Analysis Type</label>
                        <select id="prompt-select" class="form-control">
                            <option value="">Select a prompt template...</option>
                        </select>
                        <p id="prompt-description" class="description"></p>
                    </div>

                    <!-- Video Source Selection -->
                    <div class="form-group">
                        <label for="video-source">Video Source</label>
                        <select id="video-source" class="form-control">
                            <option value="url">YouTube URL</option>
                            <option value="local">Local Video</option>
                        </select>
                    </div>

                    <!-- Video URL Input (for YouTube) -->
                    <div class="form-group" id="url-group">
                        <label for="video-url">YouTube Video URL</label>
                        <input 
                            type="text" 
                            id="video-url" 
                            class="form-control" 
                            placeholder="https://youtu.be/..."
                        >
                    </div>

                    <!-- Local Video Selection -->
                    <div class="form-group hidden" id="local-group">
                        <label for="local-video">Select Local Video</label>
                        <select id="local-video" class="form-control">
                            {% for video in local_videos %}
                            <option value="{{ video.path }}">{{ video.title }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Preset Videos -->
                    <div class="form-group" id="preset-group">
                        <label>Preset Videos</label>
                        <div class="preset-grid" id="preset-grid">
                            {% for video in preset_videos %}
                            <div class="preset-item" data-url="{{ video.url }}" data-video-id="{{ video.video_id }}">
                                <img src="{{ video.thumbnail }}" alt="{{ video.title }}">
                                <span class="preset-title">{{ video.title }}</span>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Video Embed -->
                    <div class="form-group">
                        <label>Video Preview</label>
                        <div class="video-container">
                            <div id="video-placeholder" class="video-placeholder">
                                <p>Enter a YouTube URL or select a preset to preview</p>
                            </div>
                            <iframe 
                                id="video-embed" 
                                class="video-embed hidden"
                                frameborder="0" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen>
                            </iframe>
                        </div>
                    </div>

                    <!-- Analyze Button -->
                    <button id="analyze-btn" class="btn btn-primary" disabled>
                        <span class="btn-text">Analyze Video</span>
                        <span class="btn-loader hidden"></span>
                    </button>
                </div>
            </div>

            <!-- Right Panel -->
            <div class="right-panel">
                <div class="card output-card">
                    <h2>Analysis Results</h2>
                    <div id="output-container" class="output-container">
                        <div class="output-placeholder">
                            <svg class="placeholder-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <p>Select a prompt and video, then click "Analyze" to generate a report</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- Main JavaScript -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>

